# 十一、维护您的数据库

数据库维护旨在保持数据库平稳运行。数据库不是静态的；数据被添加、删除和移动，随着时间的推移，这种变化会导致数据库变得缓慢。性能不佳的数据库会耗费您的资金并浪费用户的时间。数据库维护包括备份数据库、压缩数据库和保护数据。本章与数据清理有重叠，数据清理在第 10 章中讨论。本章讨论您需要定期执行的作业。

## 备份您的数据库

维护数据库的一个重要方面就是定期备份。这样，如果它发生任何问题，将有另一个副本可用。如果没有最近的备份，您就没有机会在灾难发生后恢复数据，例如计算机丢失或被盗，或者硬盘停止工作。

只要有时间就备份数据库是不够的。应该定期安排备份。一些数据库系统自动执行备份，定期将备份发送到另一个位置。云还提供备份服务，这将在第 18 章中介绍。

理想情况下，您应该随着时间的推移运行多个备份，而不是重复覆盖同一个备份。这种方法为您提供了从任何给定时间点发生的问题中恢复的选项。最好将所有备份的数据加密，这样它们就不会被窃取；在本章的后面，您将了解更多关于加密数据的内容。

虽然现场备份很重要，但在异地保存数据库的加密副本也很重要。如果自然灾害或盗窃导致无法访问您的现场计算机或服务器，那么异地备份就变得至关重要。一般来说，备份任何一旦丢失就会妨碍业务的数据。

备份的频率取决于您特定的行业和业务需求。对于大多数企业来说，每夜备份就足够了。但是，如果您的数据在一天中发生了巨大变化，那么在关键信息发生变化时，全天备份数据库可能是有意义的。

当你有了一个好的备份系统后，你需要定期测试它以确保它能正常工作。您还需要决定谁将负责备份。

## 压缩您的数据库

当您向数据库中添加和更新数据和/或更改其设计时，文件会变得更大。这一增长部分来自新数据，但部分来自其他来源:

*   当您删除数据库行或对象(表、查询、表单等)时。)，行或对象占用的磁盘空间不会自动回收。这是因为被改变的行或对象不能被删除，而它仍然可以连接到其他地方的其他行和对象。
*   您的数据库创建临时的、隐藏的行和对象来完成各种任务。要求对数据进行排序的查询就是一个例子。有时，在任务完成后，这些临时行和对象会保留在数据库中。

数据库文件可能会快速增长，被临时行和已删除行的剩余部分以及表、表单和查询等对象填满。性能可能会受到影响:对象打开速度可能会变慢，查询运行时间可能会比平时长，典型操作可能会更耗时。

为了解决这个性能问题，一旦不再需要这样的对象和行版本，就可以回收它们占用的空间，供新的对象和行使用。避免数据库增长和随之而来的损坏的最简单方法是定期压缩数据库。许多数据库都有一个允许你这样做的功能；比如 MS Access 有一个功能叫压缩和修复。压缩过程复制数据库文件，修复其对象，删除任何临时数据，并重新排列碎片。

显然，频繁接收更新或删除的表比很少更新的表需要更频繁地压缩。设置只压缩选定表的定期任务，跳过那些不经常改变的表，这可能是有用的。

至少，每天在低使用率时间压缩一次数据库是有意义的，必要时还可以压缩更新频繁的表。请记住，不能在共享数据库打开时压缩它。因此，您需要告诉用户在多长时间内他们必须避免使用数据库。如果您记录了压缩数据库需要多长时间，您就可以对数据库不可用的时间做出相当精确的估计，并相应地提供指导。

## 优化您的硬盘和存储设备

优化您的硬盘，有时被称为碎片整理，可以被视为压缩和修复您的硬盘或存储设备。当您保存、更改或删除文件时，碎片会随着时间的推移而产生。保存到文件的更改通常存储在与原始文件不同的位置。随着时间的推移，你的机器会变慢，因为它必须在不同的地方寻找打开一个文件。磁盘优化或碎片整理是将碎片数据整合到硬盘或存储设备上的过程，因此它的工作效率会更高。

碎片严重的文件(或驱动器)速度很慢。繁忙的数据库使问题更加复杂，因为所有这些事务会产生更多碎片。因此，你应该定期整理你的硬盘。您的操作系统提供了一种称为碎片整理程序的碎片整理工具。默认情况下，一些碎片整理程序会定期自动运行；例如，在 Windows 8.1 上，碎片整理程序每周运行一次。但是，如果您愿意，也可以手动操作。

碎片整理可能需要一段时间，所以将其安排在系统不使用的时候。您拥有的每个程序和文件都将从这一过程中受益，而不仅仅是您的数据库。但是，由于数据库的大小，它特别容易因为碎片而导致性能下降。

## 拆分数据库

我们在本书中讨论的数据库，如 MS Access 或 LibreOffice 和 OpenOffice 开源数据库，都存在于桌面上。这意味着它们的文件结构不同于 SQL Server 等大型数据库，因为数据和对象存储在同一个文件中。但是，最好将数据库分成两个独立的文件—一个数据库包含表、查询、表单和报表等对象形式的数据(后端)，另一个数据库包含用户友好界面形式的入口点(前端)。

前端的一个例子是一个网页，它使用户能够预订机票，而所有的数据处理都在后台数据库中进行。

这种设置有助于防止数据库文件损坏，并通过将数据保存在用户不直接访问的单独文件中来限制数据丢失。当需要升级数据库时，只需用新版本替换旧的前端文件。如果您将数据和前端存储在同一个文件中，则必须将数据从旧文件移动到新文件中，这样效率很低。

您的数据库应该包含一个工具，使您能够使用几个简单的步骤来拆分它:MS Access 使用一个名为数据库拆分器的工具。

## 审核用户

应定期检查授权用户。对于小型企业，这可能是每个月左右。例如，您公司的一些前员工可能仍然可以访问您的数据库，这需要解决。理想情况下，最好在更改发生时更新权限，但是定期审计将帮助您找到您忘记或错过的更改。

## 维护安全的密码列表

如果您对数据库文件进行密码保护，保留一份所有密码的安全列表是很重要的。该列表及其位置需要与您信任的人共享。如果你生病了，发生了事故，或者正在度假，这时用户忘记了密码，或者新员工需要培训，那么这个列表将是必不可少的。

## 使用防火墙、防病毒和间谍软件保护软件

您的数据库需要持续和最新的病毒和间谍软件防护，系统中的所有文件也是如此。

Note

计算机病毒是一种在你不知情的情况下被加载到你的计算机上的软件，通常会执行一些不受欢迎的操作。即使是简单的病毒也能自我复制，并迅速使计算机停止运行。一些病毒访问私人数据或损坏数据。

间谍软件与病毒的相似之处在于，它会在没有警告的情况下出现，并继续做一些不受欢迎的事情。它通常旨在监视您或您的计算机，经常跟踪您访问的网站并记录您的击键，以窃取您的帐户登录信息。

防火墙是位于计算机和网络之间的软件或硬件块，只允许某些类型的数据通过。例如，防火墙可能允许检查电子邮件和浏览网页，但可能不允许诸如文件共享之类的操作。如果您通过路由器连接到互联网，那么您已经有了一种硬件防火墙来防止随机网络威胁到达您的系统。

有时病毒能够穿越防火墙进入你的系统。因此，在包括笔记本电脑和平板电脑在内的所有计算机上使用和更新抗病毒和反间谍软件是至关重要的。请记住，每天都有新的病毒产生，软件设计者需要一段时间才能赶上黑客。因此，保持您的病毒定义最新至关重要。

病毒扫描程序将定位并清除硬盘上的病毒。实时病毒扫描程序会在它们到达时注意到它们，甚至在它们攻击磁盘之前就注意到了，但这些可能很贵，并会使您的计算机稍微变慢。

## 让您的硬件、操作系统和其他软件保持最新

病毒可以在旧设备上滋生。为了保护您的数据库和其他文件，尽可能升级到新的路由器和计算机非常重要。

操作系统应该是相当新的，应该包含最新的更新，包括最新的安全修复。在您的系统上运行的其他软件也是如此。

随着时间的推移，旧的操作系统变得不受支持。例如，自 2014 年 4 月起，微软停止支持 Windows XP，并且不再提供更新。当使用 Windows XP 时，您的计算机仍然可以工作，但是它可能更容易受到安全风险和病毒的攻击。也不再支持 Internet Explorer 8。

## 加密您的数据库

您的数据库需要加密，以保护其中的数据免受黑客攻击。这是一种数据保护措施；数据保护在第 8 章的[中介绍。](08.html)

Note

加密意味着以这样一种方式转换数据，即只有具有特定代码(称为密钥)的人才能读取它。

您可以激活许多操作系统标配的全磁盘加密工具。但是，Windows 8.1 的标准版本不包括加密。您需要升级到专业版或企业版。或者，你可以使用免费的加密工具，比如 TRUECRYPT 和 GnuPG。

## 维护干净的数据库

清理数据是一项耗时且昂贵的任务，详见第 10 章[。清理完数据后，您不会希望在一小部分值发生变化后，在整个数据库中重复整个过程。确定如何保持数据库的整洁是一项挑战。两种可能的方法是:](10.html)

*   在添加新数据之前，清理所有发往数据库的新数据。
*   使用 Windows 中的数据库比较功能等工具清除数据库中修改过的任何数据，该功能可标记数据库两个版本之间对象的设计更改。如果您想识别数据本身的变化，一种方法是将您的数据移动到电子表格并使用电子表格比较。

除了检查单个值的准确性之外，您还需要识别重复的行。当进行修改以及向表中添加新行时，可能会发生这种情况。第 10 章解释了如何检测重复行。

## 摘要

数据库维护包括您将定期执行的任务。目标是让您的数据库尽可能平稳地运行，并保护它免受灾难和外部威胁。诸如备份数据库、压缩数据库以及保持软件和硬件最新等任务都很重要。